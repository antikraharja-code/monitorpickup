<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ADMIN - Monitoring Pickup Kurir</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f9;margin:0;padding:20px}
h1{margin:0}
.header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
.clock{font-weight:bold;color:#555}

.controls{margin:15px 0;display:flex;gap:10px;flex-wrap:wrap}
select,input,button{padding:8px 10px;border-radius:6px;border:1px solid #ccc;font-size:14px}
button{cursor:pointer;border:none}
.btn-show{background:#0d6efd;color:#fff}
.btn-reset{background:#dc3545;color:#fff;font-weight:bold}
.btn-excel{background:#198754;color:#fff;font-weight:bold}

.rekap{
  display:flex;
  gap:15px;
  margin-bottom:15px;
  flex-wrap:wrap;
}
.rekap-box{
  background:#fff;
  padding:12px 16px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  min-width:180px;
}
.rekap-box h3{margin:0 0 6px;font-size:14px;color:#555}
.rekap-box div{font-size:20px;font-weight:bold}

table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1)}
th,td{padding:10px;border-bottom:1px solid #eee;font-size:14px;text-align:left}
th{background:#1f2937;color:#fff;position:sticky;top:0}
tr:nth-child(even){background:#f9fafb}

.status-pickup{color:#f59e0b;font-weight:bold}
.status-selesai{color:#16a34a;font-weight:bold}
.service-normal{color:#374151}
.service-urgent{color:#dc2626;font-weight:bold}
.service-top{color:#9333ea;font-weight:bold}
.service-premium{color:#2563eb;font-weight:bold}
.stamp{color:#16a34a;font-weight:bold}
</style>
</head>

<body>

<div class="header">
  <h1>ðŸ“¦ ADMIN â€“ Monitoring Pickup Kurir</h1>
  <div class="clock" id="clock"></div>
</div>

<div class="controls">
  <select id="filterKurir">
    <option value="">Filter Kurir</option>
  </select>

  <input type="date" id="filterTanggal">
  <input type="month" id="filterBulan">

  <button class="btn-show" id="btnTampil">Tampilkan</button>
  <button class="btn-excel" id="btnExcel">â¬‡ Export Excel</button>
  <button class="btn-reset" id="btnReset">ðŸ”„ Refresh Data</button>
</div>

<!-- REKAP -->
<div class="rekap">
  <div class="rekap-box">
    <h3>Total Data</h3>
    <div id="rekapTotal">0</div>
  </div>
  <div class="rekap-box">
    <h3>Pickup</h3>
    <div id="rekapPickup">0</div>
  </div>
  <div class="rekap-box">
    <h3>Selesai</h3>
    <div id="rekapSelesai">0</div>
  </div>
</div>

<table>
<thead>
<tr>
  <th>Tanggal</th>
  <th>Kurir</th>
  <th>ID</th>
  <th>Pelanggan</th>
  <th>Lokasi Pickup</th>
  <th>Service</th>
  <th>Status Awal</th>
  <th>Status Akhir</th>
  <th>Stamp</th>
</tr>
</thead>
<tbody id="tbody">
<tr>
  <td colspan="9" style="text-align:center;color:#888">Belum ada data</td>
</tr>
</tbody>
</table>

<script>
/* JAM */
function updateClock(){
  const n=new Date();
  document.getElementById('clock').innerText=
    n.toLocaleDateString('id-ID')+' '+n.toLocaleTimeString('id-ID');
}
setInterval(updateClock,1000);updateClock();

/* DATA */
function getData(){
  return JSON.parse(localStorage.getItem('pickupData')||'[]');
}

/* RENDER */
function renderTable(data){
  const tb=document.getElementById('tbody');
  tb.innerHTML='';
  if(data.length===0){
    tb.innerHTML='<tr><td colspan="9" style="text-align:center;color:#888">Belum ada data</td></tr>';
    updateRekap([]);
    return;
  }
  data.forEach(d=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${d.tanggal||''}</td>
      <td>${d.kurir||''}</td>
      <td>${d.id||''}</td>
      <td>${d.pelanggan||''}</td>
      <td>${d.lokasi||''}</td>
      <td class="${serviceClass(d.service)}">${d.service||''}</td>
      <td class="status-pickup">${d.statusAwal||''}</td>
      <td class="status-selesai">${d.statusAkhir||''}</td>
      <td class="stamp">${d.statusAkhir?'Clear':''}</td>
    `;
    tb.appendChild(tr);
  });
  updateRekap(data);
}

/* SERVICE */
function serviceClass(s){
  if(!s) return 'service-normal';
  s=s.toLowerCase();
  if(s.includes('urgent')) return 'service-urgent';
  if(s.includes('top')) return 'service-top';
  if(s.includes('premium')) return 'service-premium';
  return 'service-normal';
}

/* FILTER KURIR */
function loadKurir(data){
  const sel=document.getElementById('filterKurir');
  const list=[...new Set(data.map(d=>d.kurir))];
  sel.innerHTML='<option value="">Filter Kurir</option>';
  list.forEach(k=>{
    const o=document.createElement('option');
    o.value=k;o.textContent=k;
    sel.appendChild(o);
  });
}

/* REKAP */
function updateRekap(data){
  document.getElementById('rekapTotal').innerText=data.length;
  document.getElementById('rekapPickup').innerText=
    data.filter(d=>d.statusAwal).length;
  document.getElementById('rekapSelesai').innerText=
    data.filter(d=>d.statusAkhir).length;
}

/* TAMPILKAN */
document.getElementById('btnTampil').onclick=function(){
  const all=getData();
  const fk=document.getElementById('filterKurir').value;
  const ft=document.getElementById('filterTanggal').value;
  const fb=document.getElementById('filterBulan').value;

  const f=all.filter(d=>{
    let ok=true;
    if(fk) ok&=(d.kurir===fk);
    if(ft) ok&=(d.tanggal===ft);
    if(fb) ok&=(d.tanggal&&d.tanggal.startsWith(fb));
    return ok;
  });
  renderTable(f);
};

/* EXPORT EXCEL */
document.getElementById('btnExcel').onclick=function(){
  const rows=[['Tanggal','Kurir','ID','Pelanggan','Lokasi','Service','Status Awal','Status Akhir','Stamp']];
  document.querySelectorAll('#tbody tr').forEach(tr=>{
    const cols=[...tr.children].map(td=>td.innerText);
    if(cols.length===9 && cols[0]!=='Belum ada data') rows.push(cols);
  });
  if(rows.length===1){alert('Tidak ada data untuk diexport');return;}

  let csv=rows.map(r=>r.join('\t')).join('\n');
  const blob=new Blob([csv],{type:'application/vnd.ms-excel'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='rekap-pickup-'+new Date().toISOString().slice(0,10)+'.xls';
  a.click();
};

/* RESET TABEL */
document.getElementById('btnReset').onclick=function(){
  if(!confirm('HANYA mengosongkan isi tabel test.\nID & Kurir TIDAK TERHAPUS.\nLanjutkan?'))return;
  localStorage.removeItem('pickupData');
  renderTable([]);
};

/* REALTIME */
function auto(){
  const d=getData();
  renderTable(d);
  loadKurir(d);
}
setInterval(auto,2000);
auto();
</script>

</body>
</html>
